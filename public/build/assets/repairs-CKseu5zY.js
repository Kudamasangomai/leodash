import{g as i,b as e,o as n,p as b,u as N,z as te,A as O,a,d as l,h as se,w as u,i as x,f as c,F as k,j as y,v as D,s as R,t as r,n as F,c as oe,l as le,e as H,B as j,H as re}from"./app-B9e9p2eJ.js";import{_ as de}from"./AuthenticatedLayout-Bc0lm461.js";import{M as ae}from"./MainContent-CDVEKC1x.js";import{P as ne,a as ie}from"./PageTitle-NEs79EAO.js";import{P as C}from"./PrimaryButton-D8HudILd.js";import{_ as S,a as M}from"./SecondaryButton-Bpc_ks0m.js";import{D as ue}from"./Deleteicon-D8-1FgLD.js";import{E as pe}from"./Editicon-BxQ--cCY.js";import{D as ce}from"./DangerButton-BbqXQ9Ht.js";import{S as L}from"./Spinner-BfJUZ2H-.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";const be={},xe={xmlns:"http://www.w3.org/2000/svg",fill:"#fff",viewBox:"0 0 24 29","stroke-width":"2",stroke:"#1F51FF",class:"inline-block w-5 h-6 mt-1",height:"1em"};function fe(v,g){return n(),i("svg",xe,[...g[0]||(g[0]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z"},null,-1)])])}const ye=me(be,[["render",fe]]),ve={key:0,class:"flex items-center gap-2"},ge={key:0,class:"flex items-center"},we={class:"py-4 ml-2"},_e={class:"relative flex justify-end w-full mt-1 mr-1 md:w-1/3 md:ml-auto"},ke={class:"flex flex-wrap items-center justify-between gap-4"},he={class:"px-2 overflow-x-auto"},Ce={class:"min-w-full border border-gray-200",id:"mytable"},De={class:"text-center divide-y divide-gray-200"},Re={class:"px-4 py-3 text-[14px] text-slate-900 border-r border-gray-200"},Fe={class:"px-4 py-3 text-[14px] text-slate-900 border-r border-gray-200"},Se=["onClick"],je={class:"px-4 py-3 text-[14px] text-slate-900 border-r border-gray-200"},Me={class:"px-4 py-3 text-[14px] border-r border-gray-200"},Le={class:"px-4 py-3 text-[14px] text-slate-900 border-r border-gray-200"},Ve={class:"px-4 py-3 text-[14px] text-slate-900 border-r border-gray-200 hidden-excel"},Ae={class:"px-4 py-3 text-[14px] text-slate-900 border-r border-gray-200 hidden-excel"},Be={class:"px-4 py-3 text-[14px] text-slate-900 border-r border-gray-200"},Ue={class:"hidden-excel px-4 py-3 text-[14px] justify-center text-slate-900 border-r border-gray-200 flex gap-2"},Ee=["onClick"],Te=["onClick"],$e=["onClick"],Ne={key:1},He={class:"flex justify-end gap-2 mt-4"},ze={class:"p-6 bg-white"},Oe={class:"mb-4 text-lg font-medium text-gray-900"},qe=["value"],Pe={key:0,class:"mt-1 text-sm text-red-600"},Je=["value"],Ie={key:0,class:"mt-1 text-sm text-red-600"},Ze={key:0},Ge={key:0,class:"mt-1 text-sm text-red-600"},Ke={class:"flex justify-end gap-3 mt-6"},Qe={key:0,class:"flex items-center gap-2"},We={class:"p-6 bg-white"},Xe={class:"flex justify-end gap-3 mt-6"},Ye={class:"p-6 bg-white"},et={key:0,class:"mt-1 text-sm text-red-600"},tt=["value"],st={key:0,class:"mt-1 text-sm text-red-600"},ot={key:0,class:"mt-1 text-sm text-red-600"},lt={class:"flex justify-end gap-3 mt-6"},rt={key:0,class:"flex items-center gap-2"},dt={class:"w-full p-6 bg-white shadow-xl rounded-2xl"},at={class:"grid grid-cols-2 gap-4"},nt={class:"flex justify-end gap-3 mt-6"},it={key:0,class:"flex items-center gap-2"},ut={class:"w-full p-6 bg-white shadow-xl rounded-2xl"},pt={class:"flex items-center justify-between mb-5"},ct={class:"space-y-4"},mt={class:"flex justify-between"},bt={class:"font-medium"},xt={class:"flex justify-between"},ft={class:"font-medium"},yt={class:"flex justify-between"},vt={class:"font-medium"},gt={class:"flex justify-between"},wt={class:"font-medium"},_t={class:"flex justify-between"},kt={class:"font-medium"},ht={class:"pt-3 border-t"},Ct={class:"p-3 bg-gray-200 rounded-lg"},Et={__name:"repairs",props:{repairs:Object,trucks:Array,faults:Array,users:Array},setup(v){const g=b(!1),V=b(!1),A=b(null),w=b(null),z=b(null),B=N({}),U=b(!1),E=b(!1),m=b(null),T=b(!1),o=N({truck_id:"",fault_id:"",status:"pending",location:"",comments:"",donebyid:"",repairedondate:""}),_=N({fromDate:"",toDate:""}),q=()=>{w.value=null,o.reset(),g.value=!0},P=d=>{w.value=d,o.truck_id=d.truck_id,o.fault_id=d.fault_id,o.status=d.status,o.location=d.location,o.repairedondate=d.repairedondate,g.value=!0},J=d=>{z.value=d,o.truck_id=d.truck_id,o.truck=d.truck.unitname,o.comments=d.comments,o.fault=d.fault.name,o.fault_id=d.fault_id,U.value=!0},I=()=>{w.value?o.put(`/repairs/${w.value.id}`,{onSuccess:()=>p()}):o.post("/repairs",{onSuccess:()=>p()})},Z=()=>{o.put(`/repairs/closerepair/${z.value.id}`,{onSuccess:()=>p()})},p=()=>{g.value=!1,w.value=null,U.value=!1,V.value=!1,A.value=null,E.value=!1,m.value=null,T.value=!1,o.reset()},G=d=>{A.value=d,V.value=!0},K=()=>{B.delete(`/repairs/${A.value.id}`,{onSuccess:()=>p()})},Q=d=>({pending:"bg-yellow-400 text-yellow-800",completed:"bg-green-400 text-green-800"})[d]||"bg-gray-100 text-gray-800",h=b(!1);function W(){h.value||(h.value=!0,O.visit("/repairs/fetchlocations",{method:"get",onFinish:()=>{h.value=!1},preserveScroll:!0}))}const $=b("");te($,d=>{O.get("/repairs",d?{q:d}:{},{preserveState:!0,preserveScroll:!0,replace:!0})});function X(d){m.value=d,E.value=!0}const Y=()=>{T.value=!0},ee=()=>{re.post("/repairs/export-excel",_.data(),{responseType:"blob"}).then(d=>{const t=new Date().toISOString().split("T")[0],s=window.URL.createObjectURL(new Blob([d.data])),f=document.createElement("a");f.href=s,f.setAttribute("download",`LeoDashRepairs_${t}.xlsx`),document.body.appendChild(f),f.click(),f.remove(),window.URL.revokeObjectURL(s),p(),_.reset()}).catch(d=>{console.error("Export failed:",d)})};return(d,t)=>(n(),i(k,null,[a(l(se),{title:"Repairs"}),a(de,null,{default:u(()=>[a(ae,null,{default:u(()=>[a(ne,null,{default:u(()=>[a(ie,null,{default:u(()=>[...t[9]||(t[9]=[c("Repairs Management",-1)])]),_:1}),e("div",null,[a(C,{onClick:W,disabled:h.value},{default:u(()=>[h.value?(n(),i("span",ve,[t[10]||(t[10]=c(" Fetching Locations ",-1)),a(L)])):(n(),i(k,{key:1},[c(" Fetch Locations ")],64))]),_:1},8,["disabled"]),a(C,{onClick:q},{default:u(()=>[...t[11]||(t[11]=[c(" + New Repair ",-1)])]),_:1})])]),_:1}),l(B).recentlySuccessful?(n(),i("span",ge,[...t[12]||(t[12]=[e("div",{class:"flex justify-center w-full"},[e("div",{class:"w-1/2 px-4 py-3 mb-4 text-teal-900 bg-teal-100 border-t-4 border-teal-500 rounded-b shadow-md",role:"alert"},[e("div",{class:"flex"},[e("div",{class:"py-1"},[e("svg",{class:"w-6 h-6 mr-4 text-teal-500 fill-current",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20"},[e("path",{d:"M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z"})])]),e("div",null,[e("p",{class:"font-bold"}," Record Deleted Successfully ")])])])],-1)])])):x("",!0),e("div",we,[t[14]||(t[14]=e("label",{for:"table-search",class:"sr-only"},"Search",-1)),e("div",_e,[y(e("input",{type:"text",class:"block w-full px-3 border border-gray-300 rounded shadow-sm",placeholder:"Search for truck or Fault","onUpdate:modelValue":t[0]||(t[0]=s=>$.value=s)},null,512),[[D,$.value]]),e("div",ke,[a(C,{type:"button",onClick:Y},{default:u(()=>[...t[13]||(t[13]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"inline w-4 h-4 mr-2 fill-current",viewBox:"0 0 67.671 67.671"},[e("path",{d:"M52.946 23.348H42.834v6h10.112c3.007 0 5.34 1.536 5.34 2.858v26.606c0 1.322-2.333 2.858-5.34 2.858H14.724c-3.007 0-5.34-1.536-5.34-2.858V32.207c0-1.322 2.333-2.858 5.34-2.858h10.11v-6h-10.11c-6.359 0-11.34 3.891-11.34 8.858v26.606c0 4.968 4.981 8.858 11.34 8.858h38.223c6.358 0 11.34-3.891 11.34-8.858V32.207c-.001-4.968-4.982-8.859-11.341-8.859z","data-original":"#000000"}),e("path",{d:"M24.957 14.955a2.99 2.99 0 0 0 2.121-.879l3.756-3.756v30.522a3 3 0 1 0 6 0V10.117l3.959 3.959c.586.586 1.354.879 2.121.879s1.535-.293 2.121-.879a2.998 2.998 0 0 0 0-4.242L36.078.877A2.987 2.987 0 0 0 33.958 0h-.046c-.767 0-1.534.291-2.12.877l-8.957 8.957a2.998 2.998 0 0 0 2.122 5.121z","data-original":"#000000"})],-1),c(" Export ",-1)])]),_:1})])])]),e("div",he,[e("table",Ce,[t[17]||(t[17]=e("thead",{class:"bg-gray-200"},[e("tr",null,[e("th",{class:"p-2 border font-medium border-r text-[13px] border-gray-300"}," Date "),e("th",{class:"p-2 border font-medium border-r text-[13px] border-gray-300"}," Truck "),e("th",{class:"p-2 border font-medium border-r text-[13px] border-gray-300"}," Fault "),e("th",{class:"p-2 border font-medium border-r text-[13px] border-gray-300"}," Status "),e("th",{class:"p-2 border font-medium border-r text-[13px] border-gray-300"}," Location "),e("th",{class:"p-2 border font-medium border-r text-[13px] border-gray-300"}," Last Reported At "),e("th",{class:"p-2 border font-medium border-r text-[13px] border-gray-300"}," Last Checked At "),e("th",{class:"p-2 border font-medium border-r text-[13px] border-gray-300 hidden-excel"}," Created By "),e("th",{class:"p-2 border font-medium border-r text-[13px] border-gray-300 hidden-excel"}," Repaired By "),e("th",{class:"p-2 border font-medium border-r text-[13px] border-gray-300"}," Repaired On "),e("th",{class:"p-2 border font-medium border-r text-[13px] border-gray-300 hidden-excel"}," Actions ")])],-1)),e("tbody",De,[v.repairs.data&&v.repairs.data.length?(n(!0),i(k,{key:0},R(v.repairs.data,s=>(n(),i("tr",{key:s.id,class:"odd:bg-gray-50"},[e("td",Re,r(s.created_at),1),e("td",Fe,[e("button",{onClick:f=>X(s),class:"text-blue-500"},r(s.truck.unitname),9,Se)]),e("td",je,r(s.fault.name),1),e("td",Me,[e("span",{class:F(["px-3 py-2 rounded text-[14px] font-semibold",Q(s.status)])},r(s.status),3)]),e("td",{class:F(["px-4 py-3 text-[14px] text-slate-900 border-r border-gray-200",["px-3 py-2 rounded text-[14px] font-semibold",s.location&&s.status==="pending"&&!s.location.toLowerCase().includes("beira")&&(s.location.toLowerCase().includes("leopack")||s.location.toLowerCase().includes("harare"))?"bg-green-400":""]])},r(s.location||"N/A"),3),e("td",{class:F([{"bg-red-400":s.status==="pending"&&s.days_without_report>1},"px-4 py-3 text-[14px] text-slate-900 border-r border-gray-200"])},r(s.last_reported_at),3),e("td",Le,r(s.last_check_at||"N/A"),1),e("td",Ve,r(s.user.name),1),e("td",Ae,r(s.done_by?.name),1),e("td",Be,[c(r(s.repairedondate),1),t[15]||(t[15]=e("br",null,null,-1))]),e("td",Ue,[e("button",{onClick:f=>P(s)},[a(pe)],8,Ee),e("button",{title:"Close",class:"mr-2",onClick:f=>J(s)},[a(ye)],8,Te),e("button",{onClick:f=>G(s)},[a(ue)],8,$e)])]))),128)):(n(),i("tr",Ne,[...t[16]||(t[16]=[e("td",{colspan:"8",class:"px-4 py-3 text-center"}," Nothing to show ",-1)])]))])]),e("div",He,[(n(!0),i(k,null,R(v.repairs.links,s=>(n(),oe(l(le),{key:s.label,href:s.url??"",innerHTML:s.label,class:F(["px-3 py-1 border border-gray-200 rounded",{"bg-blue-500 text-white":s.active,"text-gray-400":!s.url}]),"preserve-scroll":""},null,8,["href","innerHTML","class"]))),128))])])]),_:1}),a(S,{show:g.value,onClose:p},{default:u(()=>[e("div",ze,[e("h2",Oe,r(w.value?"Edit Repair":"Create New Repair"),1),e("form",{onSubmit:H(I,["prevent"]),class:"space-y-4"},[e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium"},"Truck",-1)),y(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>l(o).truck_id=s),required:"",class:"block w-full px-3 py-2 mt-1 border border-gray-300 rounded shadow-sm"},[t[18]||(t[18]=e("option",{value:""},"Select a truck",-1)),(n(!0),i(k,null,R(v.trucks,s=>(n(),i("option",{key:s.id,value:s.id},r(s.unitname),9,qe))),128))],512),[[j,l(o).truck_id]]),l(o).errors.truck_id?(n(),i("div",Pe,r(l(o).errors.truck_id),1)):x("",!0)]),e("div",null,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium"},"Fault",-1)),y(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>l(o).fault_id=s),required:"",class:"block w-full px-3 py-2 mt-1 border border-gray-300 rounded shadow-sm"},[t[20]||(t[20]=e("option",{value:""},"Select a Fault",-1)),(n(!0),i(k,null,R(v.faults,s=>(n(),i("option",{key:s.id,value:s.id},r(s.name),9,Je))),128))],512),[[j,l(o).fault_id]]),l(o).errors.fault_id?(n(),i("div",Ie,r(l(o).errors.fault_id),1)):x("",!0)]),d.editinguser?(n(),i("div",Ze,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium"},"Role",-1)),y(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>l(o).role=s),id:"inputState",class:"block w-full px-3 py-2 mt-1 border border-gray-300 rounded shadow-sm"},[...t[22]||(t[22]=[e("option",{value:"1"},"Admin",-1),e("option",{value:"0"},"User",-1)])],512),[[j,l(o).role]]),l(o).errors.role?(n(),i("div",Ge,r(l(o).errors.role),1)):x("",!0)])):x("",!0),e("div",Ke,[a(M,{onClick:p},{default:u(()=>[...t[24]||(t[24]=[c("Cancel",-1)])]),_:1}),a(C,{type:"submit",disabled:l(o).processing},{default:u(()=>[c(r(w.value?"Update":"Create")+" ",1),h.value||l(o).processing?(n(),i("span",Qe,[a(L)])):x("",!0)]),_:1},8,["disabled"])])],32)])]),_:1},8,["show"]),a(S,{show:V.value,onClose:p},{default:u(()=>[e("div",We,[t[27]||(t[27]=e("h2",{class:"text-lg font-medium text-gray-900"}," Are you sure you want to delete this repair record? ",-1)),e("div",Xe,[a(M,{onClick:p},{default:u(()=>[...t[25]||(t[25]=[c("Cancel",-1)])]),_:1}),a(ce,{onClick:K,disabled:l(B).processing},{default:u(()=>[...t[26]||(t[26]=[c(" Delete ",-1)])]),_:1},8,["disabled"])])])]),_:1},8,["show"]),a(S,{show:U.value,onClose:p},{default:u(()=>[e("div",Ye,[t[34]||(t[34]=e("h2",{class:"mb-4 text-lg font-medium text-gray-900"}," Close Repair ",-1)),e("h6",null,"Truck - "+r(l(o).truck),1),e("h6",null,"Fault - "+r(l(o).fault),1),e("form",{onSubmit:H(Z,["prevent"]),class:"space-y-4"},[t[33]||(t[33]=e("label",{class:"block text-sm font-medium"},"Job Done / comment",-1)),y(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>l(o).comments=s),type:"text",class:"block w-full px-3 py-2 mt-1 border border-gray-300 rounded shadow-sm"},null,512),[[D,l(o).comments]]),l(o).errors.comments?(n(),i("div",et,r(l(o).errors.comments),1)):x("",!0),e("div",null,[t[29]||(t[29]=e("label",{class:"block text-sm font-medium"},"Fault",-1)),y(e("select",{"onUpdate:modelValue":t[5]||(t[5]=s=>l(o).donebyid=s),required:"",class:"block w-full px-3 py-2 mt-1 border border-gray-300 rounded shadow-sm"},[t[28]||(t[28]=e("option",{value:""},"Done By",-1)),(n(!0),i(k,null,R(v.users,s=>(n(),i("option",{key:s.id,value:s.id},r(s.name),9,tt))),128))],512),[[j,l(o).donebyid]]),l(o).errors.fault_id?(n(),i("div",st,r(l(o).errors.user_id),1)):x("",!0)]),e("div",null,[t[30]||(t[30]=e("label",{class:"block text-sm font-medium"},"Repaired On",-1)),y(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>l(o).repairedondate=s),type:"date",class:"block w-full px-3 py-2 mt-1 border border-gray-300 rounded shadow-sm"},null,512),[[D,l(o).repairedondate]]),l(o).errors.repairedondate?(n(),i("div",ot,r(l(o).errors.repairedondate),1)):x("",!0)]),e("div",lt,[a(M,{onClick:p},{default:u(()=>[...t[31]||(t[31]=[c("Cancel",-1)])]),_:1}),a(C,{type:"submit",disabled:l(o).processing},{default:u(()=>[t[32]||(t[32]=c(" Close ",-1)),l(o).processing?(n(),i("span",rt,[a(L)])):x("",!0)]),_:1},8,["disabled"])])],32)])]),_:1},8,["show"]),a(S,{show:T.value,onClose:p},{default:u(()=>[e("div",null,[e("div",dt,[t[39]||(t[39]=e("div",{class:"flex items-center justify-between mb-5"},[e("h2",{class:"text-xl font-bold"}," Select Dates and Download ")],-1)),e("form",{onSubmit:H(ee,["prevent"]),class:"space-y-4"},[e("div",at,[e("div",null,[t[35]||(t[35]=e("label",{class:"block mb-2 text-sm font-medium"},"From Date",-1)),y(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>l(_).fromDate=s),type:"date",class:"block w-full px-3 py-2 border border-gray-300 rounded shadow-sm",required:""},null,512),[[D,l(_).fromDate]])]),e("div",null,[t[36]||(t[36]=e("label",{class:"block mb-2 text-sm font-medium"},"To Date",-1)),y(e("input",{"onUpdate:modelValue":t[8]||(t[8]=s=>l(_).toDate=s),type:"date",class:"block w-full px-3 py-2 border border-gray-300 rounded shadow-sm",required:""},null,512),[[D,l(_).toDate]])])]),e("div",nt,[a(M,{onClick:p},{default:u(()=>[...t[37]||(t[37]=[c("Cancel",-1)])]),_:1}),a(C,{type:"submit"},{default:u(()=>[l(_).processing?(n(),i("span",it,[a(L)])):x("",!0),t[38]||(t[38]=c(" Download Excel",-1))]),_:1})])],32)])])]),_:1},8,["show"]),a(S,{show:E.value,onClose:p},{default:u(()=>[e("div",null,[e("div",ut,[e("div",pt,[t[40]||(t[40]=e("h2",{class:"text-xl font-bold"},"Repair Details",-1)),e("span",{class:F(["px-3 py-1 font-medium rounded-full",{"bg-green-100 text-green-700":m.value.status==="completed","bg-yellow-100 text-yellow-700":m.value.status==="pending"}])},r(m.value.status),3)]),e("div",ct,[e("div",mt,[t[41]||(t[41]=e("span",{class:""},"Truck",-1)),e("span",bt,r(m.value.truck.unitname),1)]),e("div",xt,[t[42]||(t[42]=e("span",{class:""},"Fault",-1)),e("span",ft,r(m.value.fault.name),1)]),e("div",yt,[t[43]||(t[43]=e("span",{class:""},"Last Reported At",-1)),e("span",vt,r(m.value.last_reported_at),1)]),e("div",gt,[t[44]||(t[44]=e("span",{class:""},"Done By",-1)),e("span",wt,r(m.value.done_by?.name??"N/A"),1)]),e("div",_t,[t[45]||(t[45]=e("span",{class:""},"Done On",-1)),e("span",kt,r(m.value.repairedondate??"N/A"),1)]),e("div",ht,[t[46]||(t[46]=e("p",{class:"mb-1"},"Job Description",-1)),e("p",Ct,r(m.value.comments??"No description provided"),1)])]),e("div",{class:"flex justify-end mt-6"},[e("button",{onClick:p,class:"px-5 py-2 text-sm font-medium text-white transition bg-blue-600 rounded-lg hover:bg-blue-700"}," Close ")])])])]),_:1},8,["show"])]),_:1})],64))}};export{Et as default};
